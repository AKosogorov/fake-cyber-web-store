import{_ as Q,o as d,c as m,a as u,d as h,u as g,b as l,e,f as w,t as k,g as V,r as $,h as x,i as S,w as f,j as D,k as v,l as I,m as F,n as M,p as B,q as R,s as E,v as T,x as A,y as O,z as L,E as U,A as Z,B as N,C as H,D as W,F as G,G as j,H as z,I as J,J as Y}from"./index-ee83e50c.js";import{_ as K,a as X}from"./InputQuantity.vue_vue_type_script_setup_true_lang-95d8f850.js";import{_ as q,u as b,a as tt,b as et}from"./AddToFavorites.vue_vue_type_style_index_0_lang-c0ca5ff3.js";import{u as at,t as st,a as ot,_ as rt}from"./vee-validate-yup.esm-29c26862.js";import{_ as nt}from"./CyberButtonSubmit.vue_vue_type_script_setup_true_lang-4f4e50ab.js";import{u as ct}from"./write-off-61bfcf08.js";import"./VInput.vue_vue_type_script_setup_true_lang-4bdfbe48.js";import"./const-a1839806.js";import"./currency-161c01a1.js";import"./CyberButton.vue_vue_type_script_setup_true_lang-c83485c6.js";import"./types-e76a6185.js";const it={},ut={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},dt=u("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M12 23C5.92487 23 1 18.0751 1 12C1 5.92487 5.92487 1 12 1C18.0751 1 23 5.92487 23 12C23 18.0751 18.0751 23 12 23ZM12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21ZM13 15C13 16.6569 14.3431 18 16 18C17.6569 18 19 16.6569 19 15C19 13.3431 17.6569 12 16 12C14.3431 12 13 13.3431 13 15ZM16 16C16.5523 16 17 15.5523 17 15C17 14.4477 16.5523 14 16 14C15.4477 14 15 14.4477 15 15C15 15.5523 15.4477 16 16 16ZM5 9C5 10.6569 6.34315 12 8 12C9.65685 12 11 10.6569 11 9C11 7.34315 9.65685 6 8 6C6.34315 6 5 7.34315 5 9ZM8 10C8.55228 10 9 9.55229 9 9C9 8.44772 8.55228 8 8 8C7.44772 8 7 8.44772 7 9C7 9.55229 7.44772 10 8 10ZM10.118 18L16.118 6H13.882L7.88197 18H10.118Z",fill:"currentColor"},null,-1),lt=[dt];function _t(a,t){return d(),m("svg",ut,lt)}const pt=Q(it,[["render",_t]]),mt={class:"cart-total column gap-l"},ft={class:"column gap-xs"},ht={class:"cart-total__price row gap-s"},yt=h({__name:"CartTotal",setup(a){const t=g();return(s,o)=>(d(),m("div",mt,[l(e(w)),u("div",ft,[u("span",null,"Goods, "+k(e(t).totalQuantity)+" pcs.",1),u("div",ht,[V(" Total "),l(e(q),{price:e(t).total,"price-discount":e(t).discountedTotal},null,8,["price","price-discount"])])]),$(s.$slots,"order")]))}}),Ct={class:"cart-product-card"},vt={class:"cart-product-card__icon-wrap"},gt={class:"cart-product-card__info"},$t={class:"cart-product-card__quantity"},bt={class:"cart-product-card__end column gap-xs"},Pt={class:"cart-product-card__actions row gap-xs"},wt=h({__name:"CartProductCard",props:{cartProduct:null},setup(a){const t=x();return(s,o)=>{const c=S("router-link");return d(),m("div",Ct,[l(e(w)),u("div",vt,[l(e(pt),{class:"cart-product-card__icon"})]),u("div",gt,[l(c,{class:"link",to:e(t).getProduct(a.cartProduct.id)},{default:f(()=>[u("h4",null,k(a.cartProduct.title),1)]),_:1},8,["to"])]),u("div",$t,[$(s.$slots,"input-quantity")]),u("div",bt,[l(e(q),{price:a.cartProduct.total,"price-discount":a.cartProduct.discountedPrice},null,8,["price","price-discount"]),u("div",Pt,[$(s.$slots,"button-like"),$(s.$slots,"button-remove")])])])}}}),kt=h({__name:"VeeCheckbox",props:{label:null,name:null,isDisabled:{type:Boolean}},setup(a){const t=a,{value:s,errorMessage:o,handleChange:c,meta:r}=at(()=>t.name),i=D(()=>r.touched?o.value:"");return(n,_)=>(d(),v(e(K),{"model-value":e(s),label:a.label,name:a.name,"is-disabled":a.isDisabled,error:e(i),"onUpdate:modelValue":e(c)},null,8,["model-value","label","name","is-disabled","error","onUpdate:modelValue"]))}});function xt(){const a=g(),{updateCart:t}=b();async function s(o,c){const r=a.findInCart(o);if(!r)return;r.quantity=c;const{data:i}=await I.calculate(a.cartProducts);a.setCart(i);const n=F(o,i.products);n&&(r.total=n.total,r.discountedPrice=n.discountedPrice,await t())}return{updateProductQuantity:s}}const St=h({__name:"ChangeQuantity",props:{id:null,quantity:null},setup(a){const t=a,{updateProductQuantity:s}=xt(),{isLoading:o,runWithLoading:c}=tt(),{value:r,setValue:i}=M(1);B(()=>t.quantity,y),R(y);const{setTimeoutId:n,clearTimeoutId:_}=E(P,300);function p(C){_(),C!==t.quantity&&(i(C),n())}function y(){i(t.quantity)}function P(){c(()=>s(t.id,r.value))}return(C,At)=>(d(),v(e(X),{"model-value":e(r),"min-value":1,"is-disabled":e(o),"onUpdate:modelValue":p},null,8,["model-value","is-disabled"]))}});function It(){const a=g(),{updateCart:t}=b();async function s(o){a.remove(o);const{data:c}=await I.calculate(a.cartProducts);a.setCart(c),await t()}return{removeFromCart:s}}const Tt=h({__name:"RemoveFromCart",props:{id:null},setup(a){const t=a,{removeFromCart:s}=It(),{showError:o}=T();async function c(){try{await s(t.id)}catch(r){o(r.message)}}return(r,i)=>(d(),v(e(A),{onClick:c}))}});const Ot=1e3*60;function qt(){const a=O(),t=g(),{addOrder:s}=L(),{updateCart:o}=b(),{writeOff:c}=ct();async function r(_){_.isPrepaid&&await c(t.discountedTotal);const p=Date.now(),y={userId:a.user.id,dateDelivery:p+Ot,statusId:U.delivery,isPrepaid:_.isPrepaid,location:{address:"",deliveryType:Z.point},products:t.cartProducts,total:t.total,discountedTotal:t.discountedTotal,totalProducts:t.totalProducts,totalQuantity:t.totalQuantity},C=(await N.create(y)).data.name;s(C,{...y,products:y.products.slice(),createdAt:p,updatedAt:p}),await Promise.all([i(C),n()])}async function i(_){a.user.orderIds||(a.user.orderIds=[]),a.user.orderIds.push(_),await H.patchOrderIds(a.user.id,{orderIds:a.user.orderIds})}async function n(){t.clearCart(),await o()}return{createOrder:r}}const Qt=h({__name:"CreateOrderForm",setup(a){const{showError:t,showSuccess:s}=T(),{createOrder:o}=qt(),c=st(W({isPrepaid:G()})),{handleSubmit:r,isSubmitting:i}=ot({validationSchema:c,initialValues:{isPrepaid:!1}}),n=r(async _=>{try{await o({isPrepaid:!!_.isPrepaid}),s("Order successfully created")}catch(p){t(p.message)}});return(_,p)=>(d(),v(e(rt),{class:"gap-xs","handler-submit":e(n)},{"button-submit":f(()=>[l(e(nt),{class:"w-100",txt:"ORDER","is-submitting":e(i)},null,8,["is-submitting"])]),default:f(()=>[l(e(kt),{name:"isPrepaid",label:"Pay immediately"})]),_:1},8,["handler-submit"]))}}),Vt={class:"cart-page container"},Dt=u("h1",{class:"mb-s"},"Shopping basket",-1),Ft={class:"cart-page__grid"},Mt={key:0,class:"cart-page__products column gap-s"},Bt={key:1},Rt={class:"cart-page__aside"},Et={class:"relative"},Kt=h({__name:"CartPage",setup(a){const t=g(),s=O(),o=x();return(c,r)=>{const i=S("router-link");return d(),m("div",Vt,[Dt,u("div",Ft,[e(t).cartProducts.length?(d(),m("div",Mt,[(d(!0),m(j,null,z(e(t).cartProducts,n=>(d(),v(e(wt),{key:n.id,"cart-product":n},{"input-quantity":f(()=>[l(e(St),{id:n.id,quantity:n.quantity},null,8,["id","quantity"])]),"button-like":f(()=>[l(e(et),{id:n.id},null,8,["id"])]),"button-remove":f(()=>[l(e(Tt),{id:n.id},null,8,["id"])]),_:2},1032,["cart-product"]))),128))])):(d(),m("h3",Bt,"Your basket is empty")),u("aside",Rt,[l(e(yt),null,J({_:2},[e(t).cartProducts.length?{name:"order",fn:f(()=>[u("div",Et,[l(e(Qt)),e(s).isAuth?Y("",!0):(d(),v(i,{key:0,class:"abs-full",to:e(o).getLogin()},null,8,["to"]))])]),key:"0"}:void 0]),1024)])])])}}});export{Kt as default};
